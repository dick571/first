æœ¬åœ°éƒ¨ç½²çš„ RAGFlow å¯èƒ½ä¼šé‡åˆ° å‡†ç¡®ç‡ä½ å’Œ å“åº”é€Ÿåº¦æ…¢ çš„é—®é¢˜ï¼Œä¸»è¦åŸå› å¯èƒ½åŒ…æ‹¬ï¼š

ç´¢å¼•è´¨é‡ä½ï¼ˆæ•°æ®é¢„å¤„ç†å’ŒåµŒå…¥æ¨¡å‹é€‰æ‹©ä¸ä½³ï¼‰ã€‚
æ£€ç´¢ä¼˜åŒ–ä¸è¶³ï¼ˆæœªä½¿ç”¨ Query Expansionã€Hybrid Searchã€Re-rankingï¼‰ã€‚
å‘é‡æ•°æ®åº“æŸ¥è¯¢æ…¢ï¼ˆæœªä¼˜åŒ–ç´¢å¼•ç»“æ„ï¼‰ã€‚
LLM ç”Ÿæˆæ…¢ï¼ˆä½¿ç”¨äº†ä¸åˆé€‚çš„æ¨¡å‹æˆ–æ¨ç†ä¼˜åŒ–ä¸è¶³ï¼‰ã€‚
ğŸ“Œ 1. ä¼˜åŒ–æ•°æ®ç´¢å¼•
ğŸ”¹ 1.1 ä½¿ç”¨æ›´å¥½çš„åµŒå…¥æ¨¡å‹ï¼ˆEmbeddingsï¼‰

æ›¿æ¢ OpenAI Embeddings
from llama_index.embeddings import HuggingFaceEmbedding
 
embed_model = HuggingFaceEmbedding(model_name="BAAI/bge-large-en")  # æ›¿æ¢åµŒå…¥æ¨¡å‹
å¦‚æœåµŒå…¥è´¨é‡å·®ï¼Œå‘é‡æœç´¢çš„ç»“æœå°±ä¼šä¸å‡†ç¡®ï¼Œå»ºè®®ä½¿ç”¨æ›´å¼ºçš„åµŒå…¥æ¨¡å‹ï¼š
å°è¯• MistralAI/DeepSeek çš„ Embedding æ¨¡å‹
ä½¿ç”¨ Cohere Embeddingsï¼ˆCohere embed-english-v3.0 æä¾›æ›´é«˜çš„å‘é‡åŒ¹é…ç²¾åº¦ï¼‰
ğŸ“Œ 2. æ”¹è¿›æŸ¥è¯¢ä¼˜åŒ–
ğŸ”¹ 2.1 å¯ç”¨ Query Expansionï¼ˆæŸ¥è¯¢æ‰©å±•ï¼‰

é€šè¿‡ LLM æ‰©å±•ç”¨æˆ·çš„åŸå§‹æŸ¥è¯¢ï¼Œæé«˜æ£€ç´¢å‡†ç¡®æ€§ï¼š
from llama_index.query_engine import QueryTransform
 
query_transform = QueryTransform("è¯·æ‰©å±• {query}ï¼Œå¹¶æ¶µç›–ç›¸å…³æœ¯è¯­")
query_engine = index.as_query_engine(query_transform=query_transform)
response = query_engine.query("AI åœ¨åŒ»ç–—è¡Œä¸šçš„åº”ç”¨")
print(response)
âœ… æ•ˆæœï¼š

è‡ªåŠ¨æ‰©å±•æŸ¥è¯¢ï¼Œæé«˜æ£€ç´¢å‘½ä¸­ç‡ã€‚
å‡å°‘å‘é‡æ£€ç´¢çš„æ­§ä¹‰ï¼Œæå‡ç»“æœç›¸å…³æ€§ã€‚
ğŸ“Œ 3. æé«˜æ£€ç´¢è´¨é‡
ğŸ”¹ 3.1 é‡‡ç”¨ Hybrid Searchï¼ˆæ··åˆæ£€ç´¢ï¼‰ é»˜è®¤çš„å‘é‡æ£€ç´¢å¯èƒ½ä¼šå¿½ç•¥å…³é”®è¯åŒ¹é…çš„é‡è¦æ€§ï¼Œå¯ä»¥ç»“åˆ BM25 / TF-IDF æé«˜æ£€ç´¢å‡†ç¡®ç‡ã€‚

from llama_index.query_engine import HybridSearch
 
hybrid_search = HybridSearch(vector_weight=0.7, keyword_weight=0.3)  # å‘é‡+å…³é”®è¯åŒ¹é…
query_engine = index.as_query_engine(hybrid_search=hybrid_search)
response = query_engine.query("æœ€æ–°çš„ AI å‘å±•è¶‹åŠ¿")
print(response)
âœ… æ•ˆæœï¼š

å‘é‡ + å…³é”®è¯è”åˆæ£€ç´¢ï¼Œæé«˜ç›¸å…³æ€§ã€‚
é¿å…åªé è¯­ä¹‰åŒ¹é…ï¼Œå¯¼è‡´æ£€ç´¢åˆ°é”™è¯¯ä¿¡æ¯ã€‚
ğŸ”¹ 3.2 è¿›è¡Œ Rerankingï¼ˆé‡æ’åºï¼‰

è®© LLM é‡æ–°æ’åºæ£€ç´¢ç»“æœï¼Œæé«˜è´¨é‡ï¼š
from llama_index.query_engine import LLMReRanker
 
reranker = LLMReRanker(model="gpt-4")  # ä½¿ç”¨ GPT-4 å¯¹æ£€ç´¢ç»“æœæ’åº
query_engine = index.as_query_engine(reranker=reranker)
response = query_engine.query("Llama Index å’Œ LangChain çš„åŒºåˆ«ï¼Ÿ")
print(response)
âœ… æ•ˆæœï¼š

ä¼˜å…ˆè¿”å›æœ€åŒ¹é…çš„ç»“æœï¼Œå‡å°‘æ— å…³å†…å®¹ã€‚
ğŸ“Œ 4. æé«˜æŸ¥è¯¢é€Ÿåº¦
ğŸ”¹ 4.1 ä½¿ç”¨é«˜æ€§èƒ½å‘é‡æ•°æ®åº“ å¦‚æœä½¿ç”¨ FAISSï¼Œå»ºè®®é‡‡ç”¨ HNSWï¼ˆHierarchical Navigable Small Worldï¼‰ ç´¢å¼•ï¼Œæé«˜æŸ¥è¯¢é€Ÿåº¦ï¼š

import faiss
from llama_index.vector_stores import FAISSVectorStore
 
dimension = 768  # å‘é‡ç»´åº¦
faiss_index = faiss.IndexHNSWFlat(dimension, 32)  # HNSW åŠ é€Ÿæ£€ç´¢
vector_store = FAISSVectorStore(faiss_index)
âœ… æ•ˆæœï¼š

æŸ¥è¯¢é€Ÿåº¦å¤§å¹…æå‡ï¼ˆæ¯”é»˜è®¤ L2 è·ç¦»æœç´¢å¿« 10 å€ä»¥ä¸Šï¼‰ã€‚
ğŸ”¹ 4.2 ä½¿ç”¨ Pinecone / ChromaDB

å¦‚æœæ•°æ®é‡è¾ƒå¤§ï¼Œä½¿ç”¨ Pinecone æˆ– ChromaDB ä»£æ›¿ FAISSï¼Œå¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ï¼š
from llama_index.vector_stores import ChromaVectorStore
 
vector_store = ChromaVectorStore(persist_directory="./chroma_db")
storage_context = StorageContext.from_defaults(vector_store=vector_store)
âœ… æ•ˆæœï¼š

é€‚ç”¨äºå¤§è§„æ¨¡æ•°æ®å­˜å‚¨ï¼Œé¿å… FAISS å ç”¨è¿‡å¤šå†…å­˜ã€‚
ğŸ“Œ 5. ä¼˜åŒ– LLM ç”Ÿæˆé€Ÿåº¦
ğŸ”¹ 5.1 é‡‡ç”¨æœ¬åœ°é‡åŒ–æ¨¡å‹ å¦‚æœ LLM å“åº”æ…¢ï¼Œå¯ä»¥ä½¿ç”¨ é‡åŒ–åçš„æœ¬åœ°æ¨¡å‹ï¼š

from transformers import AutoModelForCausalLM, AutoTokenizer
 
model_path = "TheBloke/Llama-3-8B-GGUF"
tokenizer = AutoTokenizer.from_pretrained(model_path)
model = AutoModelForCausalLM.from_pretrained(model_path, load_in_8bit=True)  # é‡åŒ–æ¨¡å‹
âœ… æ•ˆæœï¼š

å‡å°‘ GPU å ç”¨ï¼Œæé«˜æ¨ç†é€Ÿåº¦ã€‚
ğŸ“Œ 6. å¹¶è¡ŒåŒ–æŸ¥è¯¢ï¼ˆAsync å¤„ç†ï¼‰
å¦‚æœæ£€ç´¢ & LLM ç”Ÿæˆé€Ÿåº¦æ…¢ï¼Œå¯ä»¥ä½¿ç”¨ Asyncï¼ˆå¼‚æ­¥ï¼‰å¤„ç†å¤šä¸ªæŸ¥è¯¢ï¼š

import asyncio
 
async def query_async(query):
    return await query_engine.aquery(query)
 
queries = ["AI åœ¨åŒ»ç–—çš„åº”ç”¨", "æœ€æ–°çš„ AI å‘å±•"]
results = asyncio.run(asyncio.gather(*[query_async(q) for q in queries]))
 
for r in results:
    print(r)
âœ… æ•ˆæœï¼š

å¤šä¸ªæŸ¥è¯¢å¹¶è¡Œæ‰§è¡Œï¼Œå‡å°‘ LLM è°ƒç”¨æ—¶é—´ã€‚
ğŸ“Œ 7. ç»ˆæä¼˜åŒ– Checklist
ä¼˜åŒ–ç‚¹	è§£å†³æ–¹æ¡ˆ	é¢„æœŸæ•ˆæœ
ç´¢å¼•è´¨é‡ä½	1. é‡‡ç”¨æ›´å¥½çš„åµŒå…¥æ¨¡å‹ï¼ˆå¦‚ BAAI/bge-large-enï¼‰ 2. ä½¿ç”¨ FAISS HNSW åŠ é€Ÿç´¢å¼•	âœ… æé«˜æ£€ç´¢å‡†ç¡®æ€§ï¼Œå‡å°‘æ— å…³ç»“æœ
æŸ¥è¯¢ä¼˜åŒ–ä¸è¶³	1. å¯ç”¨ Query Expansion 2. é‡‡ç”¨ Hybrid Searchï¼ˆæ··åˆæ£€ç´¢ï¼‰	âœ… å¢å¼ºæŸ¥è¯¢å‘½ä¸­ç‡ï¼Œæé«˜ç›¸å…³æ€§
å‘é‡æ•°æ®åº“æŸ¥è¯¢æ…¢	1. ä½¿ç”¨ Pinecone / ChromaDB 2. FAISS HNSW ç´¢å¼•ä¼˜åŒ–	âœ… 10 å€æå‡æŸ¥è¯¢é€Ÿåº¦
LLM ç”Ÿæˆæ…¢	1. é‡‡ç”¨ GGUF é‡åŒ– LLM 2. ä½¿ç”¨ DeepSeek / Llama3 ä»£æ›¿ GPT	âœ… åŠ å¿« LLM ç”Ÿæˆé€Ÿåº¦
æŸ¥è¯¢æµç¨‹æ…¢	1. é‡‡ç”¨å¼‚æ­¥å¤„ç† 2. é¢„åŠ è½½ç´¢å¼• & ç¼“å­˜æŸ¥è¯¢ç»“æœ	âœ… å¹¶è¡Œæ‰§è¡Œï¼Œå‡å°‘å»¶è¿Ÿ
ğŸ“Œ 8. ç»“è®º
ğŸ”¹ å¦‚æœä½ çš„ RAGFlow æŸ¥è¯¢å‡†ç¡®ç‡ä½ï¼Œå¯ä»¥ï¼š

ä¼˜åŒ–æ•°æ®ç´¢å¼•ï¼ˆæ›´å¥½çš„åµŒå…¥æ¨¡å‹ã€ç´¢å¼•å­˜å‚¨ä¼˜åŒ–ï¼‰ã€‚
ä½¿ç”¨ Hybrid Search + Query Expansion æé«˜æ£€ç´¢è´¨é‡ã€‚
å¯ç”¨ Re-rankingï¼Œç¡®ä¿è¿”å›æœ€ç›¸å…³çš„ä¿¡æ¯ã€‚
ğŸ”¹ å¦‚æœä½ çš„ RAGFlow å“åº”é€Ÿåº¦æ…¢ï¼Œå¯ä»¥ï¼š

ä½¿ç”¨ FAISS HNSW / Pinecone / ChromaDB åŠ é€Ÿå‘é‡æŸ¥è¯¢ã€‚
é‡åŒ– LLMï¼ˆGGUF/8bitï¼‰å‡å°‘æ¨ç†æ—¶é—´ã€‚
å¯ç”¨å¼‚æ­¥æŸ¥è¯¢ï¼Œæé«˜å¹¶å‘æ€§èƒ½ã€‚
ğŸ“Œ æœ€ç»ˆæ•ˆæœï¼š

ğŸš€ æé«˜ RAGFlow çš„å‡†ç¡®æ€§ï¼ˆå‡å°‘æ— å…³ä¿¡æ¯ï¼‰ã€‚
âš¡ æå‡æŸ¥è¯¢ & ç”Ÿæˆé€Ÿåº¦ï¼ˆåŠ å¿«ç”¨æˆ·å“åº”ï¼‰ã€‚
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

                            ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œéµå¾ª CC 4.0 BY-SA ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥å’Œæœ¬å£°æ˜ã€‚
                        
åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/u011296842/article/details/146165812
