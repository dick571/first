# 1. å¯¼å…¥å¿…è¦çš„åº“
import numpy as np
from sklearn.datasets import load_iris
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score, classification_report, confusion_matrix

# 2. åŠ è½½æ•°æ®é›†
# ä½¿ç”¨ç»å…¸çš„é¸¢å°¾èŠ±æ•°æ®é›†ï¼ˆIrisï¼‰
data = load_iris()
X = data.data   # ç‰¹å¾çŸ©é˜µï¼ˆ150ä¸ªæ ·æœ¬ï¼Œ4ä¸ªç‰¹å¾ï¼‰
y = data.target # ç›®æ ‡å˜é‡ï¼ˆç±»åˆ«æ ‡ç­¾ï¼š0, 1, 2ï¼‰

# 3. åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†
# å°†æ•°æ®é›†æŒ‰ 70% è®­ç»ƒé›†å’Œ 30% æµ‹è¯•é›†åˆ’åˆ†
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.3, random_state=42  # random_stateä¿è¯ç»“æœå¯å¤ç°
)

# 4. åˆ›å»ºéšæœºæ£®æ—åˆ†ç±»å™¨
# åˆå§‹åŒ–éšæœºæ£®æ—æ¨¡å‹ï¼Œè®¾ç½®å‚æ•°ï¼š
# - n_estimators: å†³ç­–æ ‘çš„æ•°é‡ï¼ˆé»˜è®¤100ï¼‰
# - max_depth: æ¯æ£µæ ‘çš„æœ€å¤§æ·±åº¦ï¼ˆé»˜è®¤ä¸é™åˆ¶ï¼‰
# - min_samples_split: èŠ‚ç‚¹åˆ†è£‚çš„æœ€å°æ ·æœ¬æ•°ï¼ˆé»˜è®¤2ï¼‰
# - random_state: éšæœºç§å­
rf_classifier = RandomForestClassifier(
    n_estimators=100,
    max_depth=None,
    min_samples_split=2,
    random_state=42
)

# 5. è®­ç»ƒæ¨¡å‹
# ä½¿ç”¨è®­ç»ƒé›†è¿›è¡Œæ¨¡å‹è®­ç»ƒ
rf_classifier.fit(X_train, y_train)

# 6. è¿›è¡Œé¢„æµ‹
# ä½¿ç”¨æµ‹è¯•é›†è¿›è¡Œé¢„æµ‹
y_pred = rf_classifier.predict(X_test)

# 7. è¯„ä¼°æ¨¡å‹æ€§èƒ½
# è®¡ç®—å‡†ç¡®ç‡
accuracy = accuracy_score(y_test, y_pred)
print(f"Accuracy: {accuracy:.2f}")

# æ‰“å°åˆ†ç±»æŠ¥å‘Šï¼ˆç²¾ç¡®ç‡ã€å¬å›ç‡ã€F1-scoreç­‰ï¼‰
print("Classification Report:")
print(classification_report(y_test, y_pred))

# æ‰“å°æ··æ·†çŸ©é˜µï¼ˆå®é™…å€¼ vs é¢„æµ‹å€¼ï¼‰
print("Confusion Matrix:")
print(confusion_matrix(y_test, y_pred))

æ•°æ®åŠ è½½
ä½¿ç”¨ load_iris() åŠ è½½å†…ç½®çš„é¸¢å°¾èŠ±æ•°æ®é›†ã€‚
X æ˜¯ç‰¹å¾çŸ©é˜µï¼Œy æ˜¯ç›®æ ‡å˜é‡ï¼ˆç±»åˆ«æ ‡ç­¾ï¼‰ã€‚
æ•°æ®åˆ’åˆ†
ä½¿ç”¨ train_test_split() å°†æ•°æ®é›†åˆ’åˆ†ä¸ºè®­ç»ƒé›†ï¼ˆ70%ï¼‰å’Œæµ‹è¯•é›†ï¼ˆ30%ï¼‰ã€‚
random_state=42 ç¡®ä¿æ¯æ¬¡è¿è¡Œä»£ç æ—¶åˆ’åˆ†ç»“æœä¸€è‡´ã€‚
æ¨¡å‹åˆ›å»º
ä½¿ç”¨ RandomForestClassifier åˆ›å»ºéšæœºæ£®æ—åˆ†ç±»å™¨ã€‚
å‚æ•°è¯´æ˜ï¼š
n_estimators=100: ä½¿ç”¨ 100 æ£µå†³ç­–æ ‘ã€‚
max_depth=None: æ¯æ£µæ ‘ä¸é™åˆ¶æœ€å¤§æ·±åº¦ã€‚
min_samples_split=2: æ¯ä¸ªèŠ‚ç‚¹è‡³å°‘éœ€è¦ 2 ä¸ªæ ·æœ¬æ‰èƒ½ç»§ç»­åˆ†è£‚ã€‚
random_state=42: ä¿è¯ç»“æœå¯é‡å¤ã€‚
æ¨¡å‹è®­ç»ƒ
ä½¿ç”¨ fit() æ–¹æ³•åœ¨è®­ç»ƒé›†ä¸Šè®­ç»ƒæ¨¡å‹ã€‚
æ¨¡å‹é¢„æµ‹
ä½¿ç”¨ predict() æ–¹æ³•å¯¹æµ‹è¯•é›†è¿›è¡Œé¢„æµ‹ã€‚
æ¨¡å‹è¯„ä¼°
ä½¿ç”¨ accuracy_score() è®¡ç®—å‡†ç¡®ç‡ã€‚
ä½¿ç”¨ classification_report() æ‰“å°åˆ†ç±»æŠ¥å‘Šï¼ˆç²¾ç¡®ç‡ã€å¬å›ç‡ã€F1-score ç­‰ï¼‰ã€‚
ä½¿ç”¨ confusion_matrix() æ‰“å°æ··æ·†çŸ©é˜µï¼ˆå®é™…å€¼ä¸é¢„æµ‹å€¼çš„å¯¹æ¯”ï¼‰ã€‚
ğŸ“Œ æ³¨æ„äº‹é¡¹
ç‰¹å¾é‡è¦æ€§

éšæœºæ£®æ—å¯ä»¥è¾“å‡ºç‰¹å¾çš„é‡è¦æ€§æ’åºï¼Œä½¿ç”¨ rf_classifier.feature_importances_ å¯æŸ¥çœ‹æ¯ä¸ªç‰¹å¾çš„è´¡çŒ®åº¦ã€‚
è¶…å‚æ•°è°ƒä¼˜

å¯ä»¥é€šè¿‡ç½‘æ ¼æœç´¢ï¼ˆGridSearchCVï¼‰è°ƒæ•´å‚æ•°ï¼ˆå¦‚ n_estimatorsã€max_depthã€min_samples_splitï¼‰ä»¥ä¼˜åŒ–æ¨¡å‹æ€§èƒ½ã€‚
å¤„ç†å…¶ä»–æ•°æ®é›†

å¦‚æœä½¿ç”¨è‡ªå®šä¹‰æ•°æ®é›†ï¼Œåªéœ€æ›¿æ¢ X å’Œ y çš„åŠ è½½éƒ¨åˆ†å³å¯ã€‚

è¾“å‡ºç¤ºä¾‹
Accuracy: 0.96
Classification Report:
              precision    recall  f1-score   support

          0       1.00      1.00      1.00        16
          1       0.94      0.94      0.94        18
          2       0.93      0.93      0.93        11

    accuracy                           0.96        45
   macro avg       0.96      0.96      0.96        45
weighted avg       0.96      0.96      0.96        45

Confusion Matrix:
[[16  0  0]
 [ 0 17  1]
 [ 0  1 10]]
